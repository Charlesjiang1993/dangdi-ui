<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>主体板块分类</title>
    <link rel="stylesheet" href="../styles/common.css">
    <script src="../js/common.js"></script>
</head>

<body>
<div>
        <div class="box float-e-margins">
            <div class="box-title">
                <a href="Badd_class.html">添加分类</a>
            </div>
            <div class="box-content">
                <table id="tables" class="table">
                    <thead>
                        <tr>
                            <th>序号</th>
                            <th>排序</th>
                            <th>分类名称</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>

                 <tr><td>1</td><td>9</td><td>┠┈影视</td><td><a href="/txttypes/update?id=111&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(111)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr><tr><td>2</td><td>8</td><td>┠┈生活</td><td><a href="/txttypes/update?id=171&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(171)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr><tr><td>3</td><td>8</td><td>┠┈科技</td><td><a href="/txttypes/update?id=281&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(281)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr><tr><td>4</td><td>7</td><td>┠┈国际</td><td><a href="/txttypes/update?id=291&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(291)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr><tr><td>5</td><td>7</td><td>┠┈社会</td><td><a href="/txttypes/update?id=301&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(301)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr><tr><td>6</td><td>5</td><td>┠┈动漫</td><td><a href="/txttypes/update?id=311&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(311)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr><tr><td>7</td><td>2</td><td>┠┈房产</td><td><a href="/txttypes/update?id=321&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(321)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr><tr><td>8</td><td>4</td><td>┠┈星座</td><td><a href="/txttypes/update?id=341&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(341)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr><tr><td>9</td><td>11</td><td>┠┈文化</td><td><a href="/txttypes/update?id=351&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(351)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr><tr><td>10</td><td>8</td><td>┠┈读书</td><td><a href="/txttypes/update?id=361&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(361)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr><tr><td>11</td><td>6</td><td>┠┈家居</td><td><a href="/txttypes/update?id=381&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(381)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr><tr><td>12</td><td>8</td><td>┠┈公益</td><td><a href="/txttypes/update?id=441&scene=2" title="修改" class="glyphicon glyphicon-pencil" aria-hidden="true"></a>
                <a href="javascript:deleteType(441)" title="删除" class="glyphicon glyphicon-trash" aria-hidden="true"></a></td></tr>
                    </tbody>
                </table>

            </div>
        </div>
        <!--end-->
    </div>
    </div>
<script type="text/javascript">
        var flag=false;
        var token=$.trim($('.token').val());
        function click_more(obj){
            var id= $.trim($(obj).attr('alt'));
            var lev= $.trim($(obj).attr('rel'));
            var obj=$(obj);

            if(!obj.hasClass('down')){
                if(id!=''){

                    if(!flag){
                        flag=true;

                        var index = parent.layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
                        $.ajax({
                            url: '/category/get-child',
                            type: 'post', /*post 提交*/
                            data: {'id':id,'rel':lev, '_csrf-backend': token},
                            dataType: 'text', /*返回文本格式的数据*/
                            success: function (e) {
                                parent.layer.close(index);
                                obj.parents('tr').after(e);
                                obj.find('i').removeClass('glyphicon-chevron-right');
                                obj.find('i').addClass('glyphicon-chevron-down');
                                obj.addClass('down');
                                flag=false;
                            },
                            error: function () {          /*请求错误*/
                                //alert("请求未能成功");

                            }
                        });
                    }
                }
            }else{
                $('tr').each(function(){
                    var pid=$.trim($(this).attr('alt'));
                    if(id==pid){
                        $(this).remove();

                    }
                })
                obj.removeClass('down').find('i').removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-right');
            }
        }

        function deleteType(id){
          if(confirm('确认删除?')){
              $.ajax({
                  url:'delete',
                  type:'get',
                  data:{"typeID":id,"_csrf-backend":token},
                  success:function(data){
                      if(data==1){
                          window.location.reload();
                      }else{
                          alert("删除失败,可能含有子分类");
                      }
                  },
                  dataType:'text'
              })
          }
        }
    </script></div>
</body>
</html>
